<!doctype html><html lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name=viewport><title>A CPU</title><link media="(prefers-color-scheme: light)" href=/aulas-faesa/img/dark-favicon.svg rel=icon><link media="(prefers-color-scheme: dark)" href=/aulas-faesa/img/light-favicon.svg rel=icon><link href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reset.min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reveal.min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/theme/white.min.css rel=stylesheet><link href=/aulas-faesa/css/bundle.min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/show-language/prism-show-language.min.css rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet></head><body><div class=reveal><div class=slides><section><h1>A CPU</h1><h2>Como o computador funciona</h2><p>Professor: Gabriel Soares Baptista</p></section><section><h1>Fundamentos da CPU</h1><h2>A Base do Compilador</h2><p>Antes de entender o compilador, precisamos entender a <strong>Unidade de Processamento Central (CPU)</strong>.</p><p>Utilizaremos uma abstração fundamental: <strong>Máquina de Estados Finitos (FSM)</strong>.</p><ul><li><strong>Definição:</strong> Modelo matemático com estados limitados e transições.</li><li><strong>Comportamento:</strong> O sistema ocupa <em>um</em> estado por vez.</li><li><strong>Transição:</strong> Ocorre via gatilho/evento específico.</li><li><strong>Aplicações:</strong> De semáforos a protocolos de rede e IA.</li></ul></section><section><h1>Uma CPU Didática: MIPS</h1><p>Utilizaremos a arquitetura <strong>MIPS</strong> (32 bits) como modelo. Ela opera com um <strong>Pipeline de 5 etapas</strong> (linha de montagem).</p><img src=../static/mips_datapath.svg style=width:85%;margin:auto;display:block></section><section><h1>Estágio 1: Busca da Instrução</h1><h2>Program Counter (PC)</h2><ul><li>Registrador que armazena o endereço da <strong>próxima instrução</strong>.</li><li>Inicia geralmente em zero.</li></ul><h2>A Matemática do Endereçamento</h2><p>Em arquiteturas de 32 bits, uma palavra (WORD) tem 4 bytes. O PC é incrementado em 4 para apontar para a próxima sequência:</p><p>$$ 4 \text{ bytes} \times 8 \text{ bits} = 32 \text{ bits} $$</p><div class="callout callout-note"><div class=callout-title><span class=callout-icon><svg viewbox="0 0 24 24" fill=none height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16 xmlns=http://www.w3.org/2000/svg><path d="M15.5 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3z"/><path d="M15 3v6h6"/><path d="M9 13h6"/><path d="M9 17h3"/></svg></span><span class=callout-title-inner>Incremento</span></div><div class=callout-content><p>O somador adiciona a constante <strong>4</strong> ao valor atual do PC a cada ciclo.</p></div></div></section><section><h1>Estágio 2: Decodificação</h1><p>A CPU interpreta o que a instrução (bits) significa.</p><h2>ISA (Instruction Set Architecture)</h2><p>Conjunto de instruções do processador (ex: x86, ARM, RISC-V). Código: <code>ADD $t0, $t1, $t2</code> $\to$ Hardware: <code>000000...</code></p><h2>Funções deste estágio:</h2><ol><li><strong>Identificar a operação:</strong> Via tabela verdade na Unidade de Controle.</li><li><strong>Acessar Registradores:</strong> Ler dados do banco de registradores (MIPS tem 32).</li><li><strong>Extensão de Sinal:</strong> Expandir constantes pequenas para 32 bits.</li></ol></section><section><h1>Estágio 3: Execução</h1><p>A mágica acontece na <strong>ALU (Arithmetic Logic Unit)</strong>.</p><h2>Controle de Fluxo (Branches)</h2><p>Saltos condicionais dependem de comparações (ex: <code>if (i == 10)</code>).</p><ol><li>CPU subtrai 10 de <code>i</code>.</li><li>Se resultado for 0, ativa a <strong>Flag Zero</strong>.</li><li>A flag avisa para <strong>não</strong> seguir para <code>PC + 4</code>.</li><li>Carrega-se um novo endereço no PC (Desvio).</li></ol></section><section><h1>Estágios 4 e 5: Memória e Escrita</h1><h2>Estágio 4: Memória</h2><ul><li>Acessa a RAM apenas se a instrução for:<ul><li><strong>Leitura (<code>LOAD</code>)</strong></li><li><strong>Escrita (<code>STORE</code>)</strong></li></ul></li></ul><h2>Estágio 5: Write Back</h2><ul><li>Grava o resultado do cálculo (da ALU) de volta no banco de registradores.</li></ul><div class="callout callout-note"><div class=callout-title><span class=callout-icon><svg viewbox="0 0 24 24" fill=none height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16 xmlns=http://www.w3.org/2000/svg><path d="M15.5 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3z"/><path d="M15 3v6h6"/><path d="M9 13h6"/><path d="M9 17h3"/></svg></span><span class=callout-title-inner>Pipeline</span></div><div class=callout-content><p>Os registradores de estágio (blocos verdes no diagrama inicial) salvam resultados intermediários, permitindo execução simultânea de múltiplas instruções.</p></div></div></section><section><h1>Questão de Fixação - 1 / 2</h1><p><strong>1.</strong> Qual é a função do registrador Program Counter (PC) e por que em várias arquiteturas de 32 bits, como o MIPS, ele é incrementado em 4 bytes a cada instrução sequencial?</p></section><section><h1>Nossa Máquina Virtual (VM)</h1><p>Focaremos em uma versão simplificada, similar à JVM, baseada em <strong>Pilha</strong>.</p><div class=col-2><img src=../static/cpu_diagram.svg style=width:40%;margin:auto;display:block><div><h3>Diferenças do MIPS</h3><ul><li>Foco no registrador <strong>SP (Stack Pointer)</strong>.</li><li>O PC ainda existe.</li><li>A VM gerencia a lógica de controle complexa.</li></ul></div></div></section><section><h1>Gerenciamento de Memória na VM</h1><div class=col-2><img src=../static/cpu_ram_diagram.svg style=width:80%;margin:auto;display:block><div><h3>1. Memória Convencional (RAM)</h3><ul><li>Dados grandes/arquivos.</li><li>Acesso via <code>LOAD</code> e <code>STORE</code>.</li><li>Exige endereços específicos.</li></ul><h3>2. A Pilha (Stack)</h3><ul><li><strong>Crucial para o compilador.</strong></li><li>Operações: <code>PUSH</code> (empilhar) e <code>POP</code> (desempilhar).</li></ul></div></div></section><section><h1>Por que usar uma Máquina de Pilha?</h1><h2>O problema dos Registradores</h2><p>Trabalhar com número restrito de registradores exige <strong>alocação de registradores</strong> (tarefa complexa).</p><h2>A Vantagem da Pilha</h2><ul><li>Simplifica a geração de código.</li><li>Apenas empilhamos valores e operamos no topo.</li><li>Remove a necessidade de gerenciar "qual dado vai para qual lugar".</li><li>Permite foco na lógica de tradução.</li></ul></section><section><h1>O Fluxo Completo</h1><p>Integração entre Código, Memória e CPU na nossa VM:</p><img src=../static/cpu_with_ram_and_program_diagram.svg style=width:80%;margin:auto;display:block><ul><li>PC aponta para instrução atual (ex: <code>ADD</code>).</li><li>PC incrementa automaticamente ou sofre salto (Loop/Função).</li></ul></section><section><h1>Questão de Fixação - 2 / 2</h1><p><strong>2.</strong> Explique a principal diferença de gerenciamento de dados entre uma arquitetura baseada em registradores, como o MIPS, e a arquitetura baseada em pilha que utilizaremos na nossa máquina virtual.</p><p><strong>3.</strong> Em qual situação o registrador PC não segue o seu incremento automático sequencial e como isso se relaciona com a execução de desvios no código?</p></section><section><h1>Próximos Passos</h1><h2>Próximo Capítulo: <a href=4%20-%20compiler%20steps.html>Etapas do processo de compilação</a></h2><ul><li>Análise em alto nível do pipeline de compilação.</li><li>Entendimento das etapas específicas.</li><li>Início da escrita do código do nosso compilador.</li></ul></section></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/reveal.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/plugin/notes/notes.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/plugin/markdown/markdown.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/5.0.4/plugin/math/math.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-clike.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-perl.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup-templating.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/show-language/prism-show-language.min.js></script><script src=/aulas-faesa/js/bundle.min.js></script><script>Reveal.initialize({hash:!0,slideNumber:`c/t`,center:!1,controls:!1,plugins:[RevealMarkdown,RevealNotes,RevealMath.KaTeX],width:960,height:800,margin:.15,maxScale:2}),Reveal.on(`slideready`,event=>Prism.highlightAll()),Reveal.on(`slidechanged`,event=>Prism.highlightAll());</script><style>.reveal{font-family:Inter,system-ui,-apple-system,sans-serif;font-size:20px;text-align:left!important}.reveal h1{align-items:center;min-height:2.3em;font-size:2.2em;display:flex;text-align:left!important;justify-content:flex-start!important;width:100%!important;margin-bottom:40px!important;margin-left:0!important}.reveal pre[class*=language-]{width:90%!important;margin:1em auto!important;padding:1em!important;font-size:.8em!important}.reveal .line-numbers .line-numbers-rows{width:3em!important;padding-top:1em!important;left:-3em!important}.reveal .line-numbers-rows>span:before{padding-right:.8em!important}.reveal pre[class*=language-].line-numbers{padding-left:3.5em!important}.reveal div.toolbar{opacity:1!important;padding-right:.5em!important}.reveal div.toolbar-item span{color:#999!important;box-shadow:none!important;background:0 0!important;border:none!important;padding:0!important;font-family:Inter,sans-serif!important;font-size:.7em!important}.reveal h2{font-size:1.6em;text-align:left!important;margin-top:30px!important;margin-bottom:20px!important}.reveal h3{font-size:1.3em;text-align:left!important;margin-top:20px!important;margin-bottom:15px!important}.reveal p{line-height:1.5;text-align:left!important;margin-top:20px!important;margin-left:0!important}.reveal ul,.reveal ol,.reveal li{line-height:1.5;text-align:left!important;margin-left:0!important}.reveal ul,.reveal ol{padding-left:1.2em!important;display:block!important}.reveal .slides section{box-sizing:border-box;text-align:left!important;padding:40px!important}.reveal .slides{text-align:left!important}.reveal .slides section:not(.stack):has(>h1:only-child),.reveal .slides section:not(.stack):has(>h1:first-child+h2:last-child),.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child){text-align:center!important;flex-direction:column!important;justify-content:center!important;align-items:center!important;height:100%!important;display:flex!important;top:0!important}.reveal .slides section:not(.stack):has(>h1:only-child) h1,.reveal .slides section:not(.stack):has(>h1:first-child+h2:last-child) h1,.reveal .slides section:not(.stack):has(>h1:first-child+h2:last-child) h2,.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child) h1,.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child) h2,.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child) p{text-align:center!important;justify-content:center!important;width:100%!important;min-height:auto!important;margin:0!important}.reveal .slides section:not(.stack):has(>h1:first-child+h2:last-child) h1,.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child) h1{margin-bottom:.5em!important}.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child) h2{margin-bottom:.3em!important}.reveal .slides section:not(.stack):has(>h1:first-child+h2+p:last-child) p{color:#666;font-size:.9em}.reveal .slides section:has(.full-screen-image){padding:0!important}.reveal:has(section.present .full-screen-image){background-image:url(../../slide_end_background.png)!important;background-position:50%!important;background-size:cover!important}.reveal:has(section.present .full-screen-image) .slides,.reveal:has(section.present .full-screen-image) .slides section.present{background:0 0!important}.full-screen-image{justify-content:center;align-items:center;width:100vw;height:100vh;display:flex;margin:0!important}.reveal .svg-graph{margin-top:1em!important;margin-bottom:1em!important;overflow:visible!important}.reveal blockquote{background:#ffaa4933;padding:5px;font-style:italic;display:block;position:relative;box-shadow:0 0 2px #0003;margin:var(--r-block-margin)auto!important;text-align:left!important}.col1{width:90%;margin:0 auto}.col2{justify-content:space-around;align-items:flex-start;width:90%;margin:0 auto;display:flex}:root{--callout-note:#448aff;--callout-abstract:#00b0ff;--callout-info:#00b8d4;--callout-todo:#00bfa5;--callout-tip:#00c853;--callout-success:#64dd17;--callout-question:#ffab00;--callout-warning:#ff9100;--callout-failure:#ff5252;--callout-danger:#ff1744;--callout-bug:#f50057;--callout-example:#7c4dff;--callout-quote:#9e9e9e;--code-bg:#f8f8f8;--border:#ddd}.reveal .callout{border:1px solid var(--border);border-left:6px solid var(--callout-note);border-radius:4px;font-size:.8em;overflow:hidden;text-align:left!important;width:75%!important;max-width:100%!important;margin:1rem auto!important}.reveal .callout-title{color:var(--callout-note);background:#0000000d;align-items:center;gap:.5rem;padding:.5rem 1rem;font-weight:600;display:flex}.reveal .callout-icon{align-items:center;display:flex}.reveal .callout-icon svg{width:1.2em;height:1.2em}.reveal .callout-content{padding:.5rem 1rem}.reveal .callout-content p{margin-top:.5rem!important}.reveal .callout-content p:first-child{margin-top:0!important}.reveal .callout-abstract{border-left-color:var(--callout-abstract)}.reveal .callout-abstract .callout-title{color:var(--callout-abstract)}.reveal .callout-info{border-left-color:var(--callout-info)}.reveal .callout-info .callout-title{color:var(--callout-info)}.reveal .callout-todo{border-left-color:var(--callout-todo)}.reveal .callout-todo .callout-title{color:var(--callout-todo)}.reveal .callout-tip{border-left-color:var(--callout-tip)}.reveal .callout-tip .callout-title{color:var(--callout-tip)}.reveal .callout-success{border-left-color:var(--callout-success)}.reveal .callout-success .callout-title{color:var(--callout-success)}.reveal .callout-question{border-left-color:var(--callout-question)}.reveal .callout-question .callout-title{color:var(--callout-question)}.reveal .callout-warning{border-left-color:var(--callout-warning)}.reveal .callout-warning .callout-title{color:var(--callout-warning)}.reveal .callout-failure{border-left-color:var(--callout-failure)}.reveal .callout-failure .callout-title{color:var(--callout-failure)}.reveal .callout-danger{border-left-color:var(--callout-danger)}.reveal .callout-danger .callout-title{color:var(--callout-danger)}.reveal .callout-bug{border-left-color:var(--callout-bug)}.reveal .callout-bug .callout-title{color:var(--callout-bug)}.reveal .callout-example{border-left-color:var(--callout-example)}.reveal .callout-example .callout-title{color:var(--callout-example)}.reveal .callout-quote{border-left-color:var(--callout-quote)}.reveal .callout-quote .callout-title{color:var(--callout-quote)}.reveal .slide-number{border-radius:4px;color:#000000b1!important;background:#0000001a!important;padding:5px 10px!important;font-size:.8em!important}</style></body></html>